<% layout('./layout') -%>


<link href="/css/jquery.tagit.css" rel="stylesheet" type="text/css">
<link href="/css/tagit.ui-zendesk.css" rel="stylesheet" type="text/css">

<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js" type="text/javascript" charset="utf-8"></script>

<script src="/js/vendor/tag-it.min.js" type="text/javascript" charset="utf-8"></script>
<script src="/js/vendor/jquery.chained.min.js" type="text/javascript"></script>
<script src="/js/vendor/jquery.form.min.js" type="text/javascript" charset="utf-8"></script>


<div style="padding: 10px;">

  <div style="margin-bottom: 20px;">
    <button class="btn btn-primary" data-toggle="modal" data-target="#addCategoryModal">
      Add Category
    </button>

  </div>

  <div>
    <table class="table table-striped">
      <tbody>
        <tr>
          <th>#</th>
          <th>Slug</th>
          <th>Name</th>
          <th>Link</th>
          <th>Sub Categories</th>
          <th>Action</th>
        </tr>
        <% for(var i=0; i<categories.length; i++) {%>
        <tr>
          <td><%= i+1 %></td>
          <td><img width="25" src="<%= categories[i].image %>"> <%= categories[i].slug_id %></td>
          <td><%= categories[i].name %></td>
          <td><%= categories[i].url %></td>
          <td><%= categories[i].sub_categories %></td>
          <td><button type="button" data-id="<%= categories[i].slug_id %>" class="action update btn btn-default" data-toggle="modal" data-target="#updateCategoryModal">Update</button></td>
        </tr>
        <% } %>
      </tbody>
    </table>
  </div>

</div>


<!-- Modal -->
<div class="modal fade" id="addCategoryModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Add Category</h4>
      </div>
      <div class="modal-body">

<form class="form-horizontal" role="form" action="/admin/category/add" method="post">
  <div class="form-group">
    <label for="name" class="col-sm-2 control-label">Name</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" name="category[name]" id="name">
    </div>
  </div>
  <div class="form-group">
    <label for="_id" class="col-sm-2 control-label">ID</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" name="category[slug_id]" id="_id">
    </div>
  </div>
  <div class="form-group">
    <label for="country" class="col-sm-2 control-label">Link</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" name="category[url]">
    </div>
  </div>
  <div class="form-group">
    <label for="country" class="col-sm-2 control-label">Icon</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" name="category[icon]">
    </div>
  </div>
  <div class="form-group">
    <label for="tags" class="col-sm-2 control-label">Sub Categories</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" name="category[sub_categories]" id="sub_categories">
    </div>
  </div>

    
  <div class="form-group">
    <div class="col-sm-offset-2 col-sm-10">
      <button type="submit" class="btn btn-default">Add</button>
    </div>
  </div>
</form>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<!-- Modal -->
<div class="modal fade" id="updateCategoryModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Update</h4>
      </div>
      <div class="modal-body">

<div class="progress progress-striped active">
  <div class="progress-bar" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
  </div>
</div>

<form class="form-horizontal" role="form" action="/admin/category/update" method="post">
  <div class="form-group">
    <label for="name" class="col-sm-2 control-label">Name</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" name="category[name]" id="name">
    </div>
  </div>
  <div class="form-group">
    <label for="_id" class="col-sm-2 control-label">ID</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" name="category[slug_id]" id="_id">
    </div>
  </div>
  <div class="form-group">
    <label for="country" class="col-sm-2 control-label">Link</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" name="category[url]" id="url">
    </div>
  </div>
  <div class="form-group">
    <label for="country" class="col-sm-2 control-label">Icon</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" name="category[icon]" id="icon">
    </div>
  </div>
  <div class="form-group">
    <label for="tags" class="col-sm-2 control-label">Sub Categories</label>
    <div class="col-sm-10">
      <input type="text" class="form-control" name="category[sub_categories]" id="sub_categories">
    </div>
  </div>

  <div class="form-group">
    <div class="col-sm-offset-2 col-sm-10">
      <button type="submit" class="btn btn-default">Update</button>
    </div>
  </div>
</form>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<script type="text/javascript">
  $(document).ready(function(){

    $('#sub_categories').tagit({allowSpaces: true});

    $('.action.update').click(function(){
      $('#updateCategoryModal form :input').attr('disabled', true);
      $('#updateCategoryModal div.progress').show();
      var _id = $(this).data('id');
      $.get('/api/category/' + _id, function(data){
        if(data){

          $('#updateCategoryModal #name').val(data.name);
          $('#updateCategoryModal #_id').val(data.slug_id);
          $('#updateCategoryModal #url').val(data.url);
          $('#updateCategoryModal #icon').val(data.icon);
          $('#updateCategoryModal #sub_categories').val(data.sub_categories);
          $('#updateCategoryModal form :input').attr('disabled', false);
          $('#updateCategoryModal div.progress').hide();

          $('#updateCategoryModal #sub_categories').tagit({allowSpaces: true});
        }
      });

    });
  });
</script>